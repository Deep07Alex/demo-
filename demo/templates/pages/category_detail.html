{% extends "base.html" %}
{% load static %}

{% block title %}{{ category_name }} - Family BookStore{% endblock %}

{% block content %}
<!-- Cart Sidebar (must be here even when extending base.html) -->
<div class="overlay" id="cartOverlay"></div>
<div class="cart-sidebar" id="cartSidebar">
  <div class="cart-header">
    <h2>Shopping Cart (<span id="cartCount">0</span>)</h2>
    <span class="close-btn" id="closeCartBtn">&times;</span>
  </div>
  <div class="cart-items" id="cartItems">
    <p class="empty-cart">Your cart is empty</p>
  </div>
  <div class="cart-footer" id="cartFooter" style="display: none;">
    <div class="cart-total">
      <span>Total:</span>
      <span id="cartTotal">â‚¹0.00</span>
    </div>
    <button class="checkout-btn" onclick="window.location.href='/checkout/'">
      Proceed to Checkout
    </button>
  </div>
</div>

<section class="book-category-page">
  <h2 class="section-title">{{ category_name }}</h2>
  
  <div class="book-grid">
    {% for book in books %}
    <a href="{% url 'book_detail' book.slug %}" class="book-card-link">
      <div class="book-card">
        <img src="{{ book.image.url }}" alt="{{ book.title }}" />
        {% if book.on_sale %}<span class="sale-tag">Sale</span>{% endif %}
        <h3 class="book-title">{{ book.title }}</h3>
        {% if book.old_price %}
        <p class="price"><span class="old">Rs. {{ book.old_price }}</span> Rs. {{ book.price }}</p>
        {% else %}
        <p class="price">Rs. {{ book.price }}</p>
        {% endif %}
        <!-- FIXED: Added proper class and data attributes -->
        <button 
          class="cart-btn add-to-cart-btn" 
          data-id="{{ book.id }}"
          data-type="book"
          data-title="{{ book.title|escapejs }}"
          data-price="{{ book.price }}"
          data-image="{{ book.image.url }}"
        >
          Add to cart
        </button>
      </div>
    </a>
    {% empty %}
    <p style="text-align: center; grid-column: 1/-1;">No books available in this category.</p>
    {% endfor %}
  </div>
</section>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/script.js' %}"></script>
<script src="{% static 'js/cart.js' %}"></script>
{% endblock %}
